# Monitoring

## Setup node-exporter, prometheus dan Grafana menggunakan docker

### 1. Install Docker

melakukan instalasi Docker melalui Bash Script seperti materi sebelumnya

![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/205d3733-7a66-414a-ac57-fef852f5b073)

### 2. Buat File ```docker-compose.yml```

buat file ```docker-compose.yml``` dan lakukan konfigurasi untuk node exporter, prometheus, dan grafana

```
version: '3.8'
volumes:
  prometheus_data: {}

services:
  node-exporter:
    image: prom/node-exporter:latest
    container_name: node-exporter
    restart: unless-stopped
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.rootfs=/rootfs'
      - '--path.sysfs=/host/sys'
      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'
    ports:
      - '9100:9100'

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    restart: unless-stopped
    volumes:
      - /home/irwansyah/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--web.enable-lifecycle'
    ports:
      - '9090:9090'

  grafana:
    image: grafana/grafana-enterprise
    container_name: grafana
    restart: unless-stopped
    ports:
     - '3000:3000'
```

![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/b69d4846-4f67-4f04-a063-f2f91b08e782)

### 3. Buat File ```prometheus.yml```

Buat File ```prometheus.yml``` dan targetkan node exporter tiap-tiap server

```
---
global:
  scrape_interval: 15s
scrape_configs:
  - job_name: appserver
    static_configs:
      - targets:
          - 103.127.132.62:9100
        labels:
          instance: appserver
  - job_name: gateway
    static_configs:
      - targets:
          - 103.127.132.55:9100
        labels:
          instance: gateway
```

![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/d70dec1d-79a8-40e6-8c89-10b279c4c923)

### 4. Jalankan docker compose up

server gateway
![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/0c08f750-5ae5-44d1-9d81-8c17707bda8b)

server appserver
![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/8a40a350-b970-4992-8ab8-b65fc9668690)

## Reverse Proxy

### 1. Install nginx

melakukan instalasi nginx secara native dengan melakukan perintah

```
sudo apt install nginx
```

![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/fbcfcbee-0dc0-467d-a1db-289f7a32d2e9)

### 2. buat file ```rproxy.conf```

menuju direktori ```/etc/nginx//sites-enabled/``` dan buat file  ```rproxy.conf``` dan lakukan konfigurasu seperti berikut

```
server {
    server_name exporterapp-irwan.studentdumbways.my.id;

    location / {
             proxy_pass http://103.127.132.62:9100/;
    }
}
server {
    server_name exportergate-irwan.studentdumbways.my.id;

    location / {
             proxy_pass http://103.127.132.55:9100/;
    }
}
server {
    server_name prom-irwan.studentdumbways.my.id;

    location / {
             proxy_pass http://103.127.132.62:9090/;
    }
}
server {
    server_name monitoring-irwan.studentdumbways.my.id;

    location / {
             proxy_set_header Host monitoring-irwan.studentdumbways.my.id;
             proxy_pass http://103.175.221.148:3333;
    }
}
```

![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/a3964708-693e-47d1-871e-2e943c2c7283)

melakukan restart nginx dengan memasukan perintah

```
sudo systemctl reload nginx
```

### 3. Melakukan Request SSL 

Melakukan Request SSL melalui certbot debgan melakukan perintah
```
sudo certbot --nginx
```
![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/5d1cb6f5-824f-4454-9dd3-6becd62e4b17)

semua DNS yang direverse proxy dalam keadaan secure atau https
![image](https://github.com/irwanpanai/devops19-dumbways-irwanpanai/assets/89429810/efe29516-b406-4d26-af89-47bded514046)

## Grafana
































































































